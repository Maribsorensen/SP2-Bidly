import{s as a}from"./main-Cbw1pNsF.js";import{a as f,c as L}from"./loadingIndicator-Dpmz7eLi.js";import{a as b,c as I,d as E}from"./apiRequest-C9VMWLkl.js";async function w(){const i=new URLSearchParams(window.location.search).get("id");if(!i){a({message:"Listing ID not found",type:"error"});return}try{const e=(await f(i))?.data??{},l=new Date,r=new Date(e.endsAt);if(l>r){const m=document.querySelector("form[name='bid-form']"),u=document.createElement("p");u.classList.add("text-center","text-brand-cta","font-paragraph","text-lg"),u.innerText="The auction has ended. No more bids can be placed on this item.",m&&(m.classList.add("hidden"),m.parentElement.appendChild(u));return}const t=e.bids?.length?Math.max(...e.bids.map(m=>m.amount)):0,o=r.toLocaleString(),p=document.getElementById("latest-bid"),g=document.getElementById("ends-at");p&&g&&(p.innerHTML=`Latest bid: <strong>${t} Credits</strong>`,g.innerHTML=`Bidding ends at: <span>${o}</span>`)}catch(c){a({message:"Error fetching bids: "+c.message,type:"error"})}}function v(){const i=localStorage.getItem("username"),c=document.getElementById("no-user"),e=document.querySelector("form[name='bid-form']");i?(c.classList.add("hidden"),e.classList.remove("hidden")):(c.classList.remove("hidden"),e.classList.add("hidden"))}async function S(i){i.preventDefault();const e=new URLSearchParams(window.location.search).get("id"),l=document.getElementById("bid-amount"),r=Number(l?.value);if(!e||!r||r<=0){a({message:"Invalid bid amount",type:"warning"});return}try{const o=(await f(e))?.data??{},p=o.bids?.length?Math.max(...o.bids.map(n=>n.amount)):0,g=localStorage.getItem("username");if(!g){a({message:"You must be logged in to bid on this listing",type:"error"});return}const u=(await b(`${I}/${g}`,"GET",null,!0))?.data?.credits??0;if(r<=p){a({message:"You bid must be higher than the current bid",type:"warning"});return}if(r>u){a({message:"Insufficient credits to place this bid",type:"error"});return}await b(`${E}/${e}/bids`,"POST",{amount:r},!0),a({message:"Bid placed successfully!",type:"success"}),l.value="",await w()}catch(t){a({message:"Error placing bid: "+t.message,type:"error"})}}async function x(){const c=new URLSearchParams(window.location.search).get("id");if(!c){a({message:"Not able to find listing, please try again...",type:"error"});return}const e=document.getElementById("listing-description");if(!e){a({message:"Not able to show listing, please try again...",type:"error"});return}const l=L("Loading listing...",80);e.appendChild(l);try{const t=(await f(c)).data;if(!t){a({message:"Not able to find listing, please try again...",type:"error"});return}document.title=`${t.title} | Bidly - Place Your Bid Now`;const o=e.querySelector("#image-container"),p=e.querySelector("#listing-title"),g=e.querySelector("#listing-seller"),m=e.querySelector("#listing-description-text"),u=e.querySelector("#listing-category");if(p.textContent=t.title||"No title available",g.textContent=t.seller?t.seller.name:"Unknown seller",m.textContent=t.description||"No description available",u.textContent=`Categories: ${t.tags}`||"Uncategorized",t.media&&t.media.length>0){o.innerHTML="";const n=t.media.map((s,h)=>{const d=document.createElement("img");return d.src=s.url,d.alt=s.alt||"Listing image",d.classList.add("w-full","h-96","object-cover","rounded-lg","shadow-md","hidden"),h===0&&d.classList.remove("hidden"),d});if(n.forEach(s=>o.appendChild(s)),t.media.length>1){let s=0;const h=document.createElement("button");h.textContent="Next",h.classList.add("absolute","bottom-4","right-4","bg-brand-main","text-white","font-paragraph","hover:bg-brand-mainhover","p-2","rounded","w-fit"),h.onclick=function(){n[s].classList.add("hidden"),s=(s+1)%n.length,n[s].classList.remove("hidden")};const d=document.createElement("button");d.textContent="Prev",d.classList.add("absolute","bottom-4","left-4","bg-brand-main","text-white","font-paragraph","hover:bg-brand-mainhover","p-2","rounded","w-fit"),d.onclick=function(){n[s].classList.add("hidden"),s=(s-1+n.length)%n.length,n[s].classList.remove("hidden")},o.appendChild(d),o.appendChild(h)}}else{const n=document.createElement("img");n.src="../../Gavel.png",n.alt="Default auction image",n.classList.add("w-full","h-56","object-cover","rounded-lg","shadow-md"),o.appendChild(n)}}catch{a({message:"Not able to find listing, please try again...",type:"error"})}finally{l&&l.remove()}}const y=document.querySelector("form[name='bid-form']");y&&y.addEventListener("submit",async i=>{i.preventDefault(),await S(i)});w();v();x();

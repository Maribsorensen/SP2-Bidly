import{s}from"./main-C6zY-29k.js";import{a as u}from"./authGuard-C2GFzsuy.js";import{b as g,c as f}from"./loadingIndicator-Dpmz7eLi.js";import{a as d,d as h,c as y}from"./apiRequest-C9VMWLkl.js";async function E(t){t.stopPropagation();const e=t.target.closest("div"),n=e.getAttribute("data-id");if(!n){s({message:"Listing ID not found, please try again...",type:"error"});return}s({message:"Are you sure you want to delete this listing?",type:"confirm",onConfirm:async()=>{try{await d(`${h}/${n}`,"DELETE",null,!0),e.remove(),s({message:"Listing deleted successfully!",type:"success"})}catch(o){s({message:"Error deleting listing: "+o.message,type:"error"})}}})}async function L(t){const e=new URL(`${y}/${t}`);return e.searchParams.append("_listings","true"),e.searchParams.append("_wins","true"),d(e,"GET",null,!0)}async function C(){const t=localStorage.getItem("username"),e=document.getElementById("profile-information");if(!e){s({message:"Profile container not found",type:"error"});return}const n=f("Loading profile...",80);e.appendChild(n);try{const r=(await L(t)).data;if(!r){s({message:"Profile not found",type:"error"});return}const l=e.querySelector("#profile-username"),a=e.querySelector("#profile-avatar"),i=e.querySelector("#profile-bio"),c=e.querySelector("#profile-credits"),m=e.querySelector("#profile-total-listings"),p=e.querySelector("#profile-total-wins");l.textContent=`${r.name}'s Profile`,r.avatar?(a.src=r.avatar.url||r.avatar,a.alt=r.avatar.alt||"User Avatar"):(a.src="../Gavel.png",a.alt="Default Avatar"),i.textContent=r.bio||"No bio available",c.textContent=`Credits: ${r.credits??0}`,m.textContent=`Total listings: ${r._count?.listings??0}`,p.textContent=`Total wins: ${r._count?.wins??0}`}catch(o){s({message:"Error fetching profile: "+o.message,type:"error"})}finally{n.remove()}}async function x(){const t=localStorage.getItem("username");if(!t){s({message:"No username found",type:"error"});return}try{const e=await g(t),n=document.getElementById("profile-listings");n.innerHTML="",e.data.forEach(o=>{const r=v(o);n.appendChild(r)})}catch(e){s({message:"Error displaying listings: "+e.message,type:"error"})}}function v(t){const e=document.createElement("div");e.classList.add("flex","flex-col","gap-3","text-center","shadow-md","justify-between","p-2"),e.setAttribute("data-id",t.id),e.addEventListener("click",()=>{window.location.href=`/listing/singleListing/?id=${t.id}`});const n=document.createElement("div");if(e.appendChild(n),t.media&&t.media.length>0){const a=t.media[0],i=document.createElement("img");i.setAttribute("src",a.url),i.setAttribute("alt",a.alt||"Listing image"),i.classList.add("w-full","h-60","object-cover","rounded-md"),n.appendChild(i)}else{const a=document.createElement("img");a.setAttribute("src","path_to_placeholder_image.jpg"),a.setAttribute("alt","No image available"),n.appendChild(a)}const o=document.createElement("div");e.appendChild(o);const r=document.createElement("h3");if(r.textContent=t.title,r.classList.add("font-paragraph","text-2xl"),o.appendChild(r),t.seller&&t.seller.name){const a=document.createElement("p");a.textContent=`Sold by: ${t.seller.name}`,a.classList.add("font-paragraph","text-lg","text-slate-600"),o.appendChild(a)}const l=localStorage.getItem("username");if(l&&t.seller&&t.seller.name===l){const a=document.createElement("button");a.textContent="Edit listing",a.classList.add("w-fit","font-paragraph","text-lg","bg-brand-main","hover:bg-brand-mainhover","transition","duration-200","px-2","rounded-md","text-white","mx-auto"),a.addEventListener("click",c=>{c.stopPropagation(),window.location.href=`/listing/edit/?id=${t.id}`}),e.appendChild(a);const i=document.createElement("i");i.className="fa-regular fa-trash-can text-slate-700 hover:text-red-600 cursor-pointer transition duration-200 text-2xl p-2 w-fit mx-auto",i.setAttribute("aria-label","Delete Listing"),i.addEventListener("click",E),e.appendChild(i)}return e}x();C();u();export{v as createProfileListingElement};
